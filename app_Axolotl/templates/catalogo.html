{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cat√°logo - AXOLOTL MUSIC</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <style>
        body { background: linear-gradient(180deg,#fff0fb 0%, #ffe6f6 30%, #fff 100%); color: #110014; font-family: Inter, system-ui, Arial, sans-serif; }
        .catalogo-hero { background: linear-gradient(90deg,#ff66cc 0%, #c51a8d 100%); color: #fff; padding: 48px 20px; text-align: center; border-bottom: 6px solid #110014; }
        .catalogo-hero h1 { margin: 0; font-size: 2.6rem; letter-spacing: -1px; }
        .catalogo-hero p { margin: 8px 0 0 0; opacity: 0.95; }
        .catalogo-container { max-width: 1200px; margin: 28px auto; padding: 12px 16px; }
        /* Grid: filas horizontales fijas seg√∫n tama√±o de pantalla */
        .catalogo-grid { display: grid; gap: 18px; align-items: start; justify-items: stretch; grid-auto-rows: 1fr; }
        /* Desktop: 3 columnas, Tablet: 2 columnas, M√≥vil: 1 columna */
        @media (min-width: 1000px) {
            .catalogo-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media (min-width: 700px) and (max-width: 999px) {
            .catalogo-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 699px) {
            .catalogo-grid { grid-template-columns: 1fr; }
        }

        .card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,0,20,0.06); border: 2px solid #ffe6f6; display:flex; flex-direction:column; width:100%; min-width:0; height:100%; }
        .card-img { flex: 0 0 160px; }
        .card-body { padding: 12px; display:flex; flex-direction:column; gap:8px; flex:1 1 auto; }
        .product-desc { color:#6b4057; font-size:13px; line-height:1.2; max-height:48px; overflow:hidden; }
        .card-footer { padding: 12px; display:flex; gap:8px; align-items:center; }
        .card-img { height: 180px; background: linear-gradient(135deg,#ffb6d9,#ff66cc); display:flex; align-items:center; justify-content:center; font-size:48px; color:#fff; }
        .card-body { padding: 12px; display:flex; flex-direction:column; gap:8px; flex:1; }
        .product-name { font-weight:800; color:#110014; font-size:16px; display:flex; align-items:center; justify-content:space-between; }
        .type-badge { background:#110014; color:#fff; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700; }
        .product-artist { color:#c51a8d; font-weight:700; font-size:13px; }
        .product-desc { color:#6b4057; font-size:13px; line-height:1.2; }
        .product-meta { display:flex; justify-content:space-between; align-items:center; gap:8px; }
        .price { font-weight:900; color:#110014; font-size:16px; }
        .card-footer { padding: 12px; display:flex; gap:8px; }
        .btn { flex:1; padding:8px 10px; border-radius:10px; text-align:center; text-decoration:none; font-weight:800; color:#fff; }
        .btn-primary { background: linear-gradient(90deg,#110014,#2b0030); }
        .btn-outline { background: transparent; border:2px solid #110014; color:#110014; }
        .axolotl-spot { display:flex; align-items:center; gap:8px; font-weight:800; color:#110014; }
        footer.catalogo-foot { text-align:center; padding:20px 12px; color:#666; }
        @media (max-width:700px){ .catalogo-hero h1{ font-size:1.8rem } }
    </style>
</head>
<body style="display:flex;flex-direction:column;min-height:100vh;">
    {% include 'navbar.html' %}
    <header class="catalogo-hero">
        <div class="catalogo-hero-inner">
            <h1>Explora el Cat√°logo Completo</h1>
            <p>Todos los productos de Axolotl Music ‚Äî m√∫sica en vinilo, CD y casete. Con amor por los ajolotes ü¶é</p>
        </div>
    </header>

    <main class="catalogo-container" style="flex:1;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
            <div></div>
            <div style="font-size:13px;color:#666;">Productos: <strong>{{ productos.count }}</strong></div>
        </div>

        {% for genero, items in productos_por_genero.items %}
            <section style="margin-bottom:28px;">
                <h3 style="color:#2b0030;margin:6px 0 12px 0;">{{ genero }}</h3>
                <div class="catalogo-grid">
                    {% for producto in items %}
                    <article class="card">
                        <div class="card-img">
                            {% if producto.img %}
                                <img src="{{ producto.img.url }}" alt="{{ producto.nombre_producto }}" style="width:100%;height:100%;object-fit:cover;">
                            {% else %}
                                üé∂
                            {% endif %}
                        </div>
                        <div class="card-body">
                            <div class="product-name">
                                <span>{{ producto.nombre_producto }}</span>
                                <span class="type-badge">{% if producto.tipo == 'vinilo' %}üéµ{% elif producto.tipo == 'cd' %}üíø{% elif producto.tipo == 'casete' %}üìº{% endif %} {{ producto.get_tipo_display }}</span>
                            </div>
                            <div class="product-artist">{{ producto.artista.nombre_artista }}</div>
                            <div class="product-desc">{{ producto.descripcion|truncatewords:18 }}</div>
                            <div class="product-meta">
                                <div class="price">${{ producto.precio }}</div>
                                {% if producto.stock is not None %}
                                    <div style="font-size:12px;color:#666;">Stock: <strong style="color:#110014">{{ producto.stock }}</strong></div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="card-footer">
                            {% if producto.stock is not None and producto.stock <= 0 %}
                                <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;">
                                    <span class="btn btn-primary" style="background:#999;cursor:not-allowed;">Fuera de stock</span>
                                </div>
                            {% else %}
                                {% if request.user.is_authenticated and not request.user.is_staff %}
                                    <form method="post" action="{% url 'add_to_cart' producto.id %}" style="flex:1;">
                                        {% csrf_token %}
                                        <input type="hidden" name="next" value="{% url 'catalogo_frontend' %}">
                                        <button type="submit" class="btn btn-primary">üõí Carrito</button>
                                    </form>
                                    <a href="{% url 'finalizar_frontend' %}?artista={{ producto.artista.nombre_artista|urlencode }}&producto={{ producto.nombre_producto|urlencode }}&precio={{ producto.precio }}" class="btn btn-outline">üí≥ Comprar</a>
                                {% elif request.user.is_authenticated and request.user.is_staff %}
                                    <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;">
                                        <span style="color:#c51a8d;font-size:13px;font-weight:700;">Cuenta administrativa ‚Äî solo vista, no puede comprar</span>
                                    </div>
                                {% else %}
                                    <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;">
                                        <span style="color:#c51a8d;font-size:13px;font-weight:600;">Inicia sesi√≥n para comprar o agregar al carrito</span>
                                        <a href="{% url 'login_frontend' %}" class="btn btn-primary" style="background:#c51a8d;">Iniciar sesi√≥n</a>
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </article>
                    {% endfor %}
                </div>
            </section>
        {% endfor %}

    </main>

    <footer class="catalogo-foot">Hecho con ‚ù§Ô∏è por Ajolotes y m√∫sica ‚Äî Axolotl Music</footer>
    {% include 'footer.html' %}
</body>
</html>